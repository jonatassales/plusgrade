# Plusgrade Monorepo

This repository contains a full interview-ready solution split into clear,
focused parts: a **Tax API**, an **Auth API**, a **Web App**, and a shared
**Design Tokens** package. Everything lives in one place so the system is easy to
run, inspect, and validate end-to-end.

It is designed to be practical for both technical and non-technical readers:
you can quickly understand each part, start the stack with Docker Compose, and
run a direct validation battery that checks the exact Plusgrade interview
scenarios.

## :bar_chart: Insights

![Alt](https://repobeats.axiom.co/api/embed/7d5823b40a8d6d0cf183bc980d190772e54b97c8.svg "Repobeats analytics image")

---

## ğŸš€ Quick Clone

```bash
git clone git@github.com:jonatassales/plusgrade.git
cd plusgrade
```

---

## ğŸ—‚ï¸ Monorepo Structure

```bash
plusgrade/
â”œâ”€ apps/
â”‚  â”œâ”€ api-tax/
â”‚  â”œâ”€ api-auth/
â”‚  â””â”€ web/
â”œâ”€ packages/
â”‚  â””â”€ design-tokens/
â”œâ”€ bin/
â”‚  â”œâ”€ docker/
â”‚  â”œâ”€ hooks/
â”‚  â””â”€ validation/
â”œâ”€ .agents/
â”‚  â”œâ”€ api-tax/ARCHITECTURE.md
â”‚  â”œâ”€ api-auth/ARCHITECTURE.md
â”‚  â”œâ”€ web/ARCHITECTURE.md
â”‚  â””â”€ design-tokens/ARCHITECTURE.md
â”œâ”€ docker-compose.yml
â””â”€ README.md
```

---

## ğŸ” Glossary

| Area | Description | README |
| --- | --- | --- |
| `apps/api-tax` | Tax calculation API and Plusgrade integration layer | [Open](./apps/api-tax/README.md) |
| `apps/api-auth` | Authentication API with JWT + refresh-token flow | [Open](./apps/api-auth/README.md) |
| `apps/web` | Next.js web client that consumes APIs + tokens | [Open](./apps/web/README.md) |
| `packages/design-tokens` | Shared design token package for web apps | [Open](./packages/design-tokens/README.md) |

---

## ğŸ§± Architecture Approaches & Design Patterns

Cross-project patterns used in this monorepo:

- **Clean Architecture**
- **Hexagonal Architecture**
- **Ports and Adapters**
- **Cache-Aside Pattern** (Redis on tax-rate retrieval flow)
- **Value Objects** for domain invariants
- **Boundary Validation** (pipes/schemas at API edges)
- **Fail-Fast Environment Configuration** (required env vars)

These patterns are implemented in different intensities depending on each appâ€™s
responsibility.

---

## :open_file_folder: Apps

### ğŸ§¾ `api-tax`

`api-tax` is an intermediate API between consumers and the Plusgrade tax
endpoint. It fetches tax brackets, applies resilient fetch behavior for unstable
upstream scenarios, caches tax-rate snapshots in Redis, and returns complete
calculation outputs:

- total taxes owed
- effective tax rate
- taxes owed per band

**Main tech:** NestJS, Axios, Redis (`ioredis`), Jest/Supertest.

### ğŸ” `api-auth`

`api-auth` is responsible for authentication and token lifecycle operations. It
supports signup/login, protected profile access, refresh validation, and logout
invalidation. Refresh tokens are persisted as hashes, and token verification is
performed with explicit guards and use cases.

**Main tech:** NestJS, Mongoose/MongoDB, JWT, bcrypt, Zod pipes, Jest/Supertest.

### ğŸŒ `web`

`web` is the Next.js user interface layer. It consumes shared design tokens and
integrates with backend APIs. It keeps UI composition separate from infra-level
UI primitives and is prepared for scaling into additional web surfaces.

**Main tech:** Next.js, React, shadcn/Radix ecosystem, Tailwind CSS, Zod.

---

## :package: Packages

### ğŸ–Œï¸ `design-tokens`

`design-tokens` is the shared visual foundation package. It centralizes CSS
variables for colors, spacing, radius, and shadows, allowing consistent branding
across current and future web applications.

When tokens change here, all consuming apps can inherit the update in a
controlled and predictable way.

**Main tech:** PostCSS, postcss-import, CSS variable exports.

---

## ğŸ¤– About `.agents/`

Think of `.agents/*/ARCHITECTURE.md` as **project blueprints**: like a building
plan before construction. They capture architectural decisions, code design
boundaries, and implementation approaches used by each app/package.

They are **not** meant to imply autonomous development without human
decision-making. The execution is curated by the developer, with AI operating
as a copilot during implementation and refinement.

### ğŸ“š Architecture Docs Glossary

| Scope | Architecture doc |
| --- | --- |
| API Tax | [.agents/api-tax/ARCHITECTURE.md](./.agents/api-tax/ARCHITECTURE.md) |
| API Auth | [.agents/api-auth/ARCHITECTURE.md](./.agents/api-auth/ARCHITECTURE.md) |
| Web | [.agents/web/ARCHITECTURE.md](./.agents/web/ARCHITECTURE.md) |
| Design Tokens | [.agents/design-tokens/ARCHITECTURE.md](./.agents/design-tokens/ARCHITECTURE.md) |

---

## ğŸ› ï¸ Getting Started

From the repository root, run Docker lifecycle commands explicitly:

```bash
pnpm docker:down
pnpm docker:up
pnpm docker:ps
```

### ğŸ“¡ Running Services

| Compose service | Container | URL / Port |
| --- | --- | --- |
| `plusgrade-api` | generated by Compose | `http://localhost:5001` |
| `api-auth` | `api-auth` | `http://localhost:7000` |
| `api-tax` | `api-tax` | `http://localhost:7001` |
| `web` | `web` | `http://localhost:3000` |
| `mongo` | `mongo-auth` | `localhost:27017` |
| `redis` | `api-tax-cache` | `localhost:6379` |

To stop everything:

```bash
docker compose down
```

---

## ğŸ§ª Monorepo Quality Commands

Run from repository root:

```bash
pnpm build
pnpm format
pnpm lint
pnpm -r --if-present test
```

What each command does:

- `pnpm build` â†’ runs build across workspace packages/apps
- `pnpm format` â†’ formats files with Biome
- `pnpm lint` â†’ runs Biome checks
- `pnpm -r --if-present test` â†’ runs tests in workspaces that define test scripts

---

## âœ… Plusgrade Validation Battery

Use this battery to check that implementation behavior matches the interview
requirements.

### 1) Tax calculation rules (2022 scenarios)

```bash
pnpm validation:api:tax:rules
```

Expected totals:

- Salary `0` âœ `totalTax = 0`
- Salary `50000` âœ `totalTax = 7500`
- Salary `100000` âœ `totalTax = 17739.17`
- Salary `1234567` âœ `totalTax = 385587.65`

### 2) Tax negative checks

```bash
pnpm validation:api:tax:negative
```

Expected status:

- Invalid year (`2018`) âœ `400`
- Invalid salary (`-1`) âœ `400`

### 3) Auth smoke flow

```bash
pnpm validation:api:auth:flow
```

### 4) Run all API validations

```bash
pnpm validation:api:smoke
```

Expected status sequence for auth validation:

- signup âœ `201` (or `409` if already exists)
- login âœ `200`
- me âœ `200`
- refresh âœ `200`
- logout âœ `200`
- refresh after logout âœ `401`
